#!/usr/bin/env bash

################################################################################
# Help                                                                         #
################################################################################
displayHelp()
{
   # Display Help
   echo ""
   echo "Orkestra"
   echo "====================="
   echo ""
   echo "This script allows to ease the development of an application using Orkestra Framework."
   echo ""
   echo "Usage:"
   echo "  ok [options] [COMMAND] [ARGS...]"
   echo "Commands:"
   echo "  up|start         Starts the containers"
   echo "  down|start       Stops the containers"
   echo "  restart          Reloads the containers."
   echo "  php              Executes the PHP binary from the PHP container."
   echo "  console          Executes the Symfony console from the PHP container."
   echo "  composer         Executes composer from the PHP container."
   echo "  yarn             Executes yarn from the PHP container."
   echo "  npm              Executes npm from the PHP container."
   echo "  pgsql            Executes pgsql from the PHP container."
   echo "  supervisorctl    Executes supervisorctl from the PHP container."
   echo "  help             Displays this help message."
   echo
}

command=$1


case "$command" in
  up|start)
    shift 1
    docker-compose up -d "$@"
  ;;

  restart)
    shift 1
    docker-compose restart "$@"
  ;;

  down|stop)
    shift 1
    docker-compose down "$@"
  ;;

  php)
    shift 1
    docker-compose exec php php "$@"
  ;;

  console)
    shift 1
    docker-compose exec php bash -c "/srv/app/bin/console $@"
  ;;

  composer)
    shift 1
    docker-compose exec php composer "$@"
  ;;

  yarn)
    shift 1
    docker-compose exec php yarn "$@"
  ;;

  npm)
    shift 1
    docker-compose exec php npm "$@"
  ;;

  bash)
    shift 1
    docker-compose exec php bash
  ;;

  pgsql)
    shift 1
    docker-compose exec postgresql bash -c "psql -U postgres $@"
  ;;

  supervisorctl)
    shift 1
    docker-compose exec bash -c "supervisorctl -c /etc/supervisor.d/supervisor.ini"
  ;;

  *)
    displayHelp
    # docker-compose "$@"
  ;;
esac