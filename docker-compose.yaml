version: '3.7'
services:
    php:
        container_name: orkestra_framework_php
        build:
            context: docker/php-fpm
            target: php_dev
        restart: always
        ports:
            - 9090:9090

        volumes:
            # Monorepo
            - ./:/srv/app/

            # Mount ssh keys
            - ~/.ssh/:/root/.ssh/

            # PHP Ini config
            - ./docker/php-fpm/conf.d:/usr/local/etc/php/conf.d:rw

        environment:
            - PHP_DATE_TIMEZONE=${TIMEZONE:-UTC}
        command: php-fpm

    postgresql:
        container_name: orkestra_framework_postgresql
        image: 'docker.io/bitnami/postgresql:11-debian-10'
        ports:
            - 5432:5432
        volumes:
            - orkestra_postgresql_data:/bitnami/postgresql
        environment:
            - 'ALLOW_EMPTY_PASSWORD=yes'

volumes:
    orkestra_postgresql_data:
        driver: local